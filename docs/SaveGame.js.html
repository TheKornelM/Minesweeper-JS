<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: SaveGame.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: SaveGame.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module
 */

"use strict";

import { default as Minesweeper, MIN_SIZE, MAX_SIZE } from "./Minesweeper.js";
import Field from "./Field.js";
import Difficulty from "./Difficulty.js";
import * as CurrentDate from "./CurrentDate.js";

/**
 * Parses saved games from localStorage.
 *
 * @returns {Array} An array of saved games.
 */
const parseGames = () => {
    let games = JSON.parse(localStorage.getItem("savedGames"));
    return !games ? [] : games;
};

const searchParams = new URLSearchParams(window.location.search);
let games = parseGames();
CurrentDate.setLocationCode("hu-HU");

/**
 * Refreshes the cached games in localStorage.
 *
 * @param {Array} games - The array of games to be saved.
 */
const refreshCachedGames = (games) =>
    localStorage.setItem("savedGames", JSON.stringify(games));

/**
 * Deletes all saved games from localStorage.
 */
export const deleteSaves = () => localStorage.removeItem("savedGames");

/**
 * Generates a save name based on the current date and time.
 *
 * @returns {string} The generated save name.
 */
export const getSaveName = () => `${CurrentDate.date()} ${CurrentDate.time()}`;

/**
 * Saves a game to localStorage.
 *
 * @param {string} saveName - The name of the save.
 * @param {Object} game - The game object to be saved.
 * @param {number} elapsedTime - The elapsed time of the game.
 */
export function saveGame(saveName, game, elapsedTime) {
    games.push({
        name: saveName,
        board: game,
        elapsedTime: elapsedTime,
    });

    refreshCachedGames(games);
}

/**
 * Loads a game from localStorage based on the URL search parameter.
 *
 * @returns {Object|null} The loaded game object or null if not found.
 */
export function loadGame() {
    let id = searchParams.get("id");
    if (!id || isNaN(id) || id &lt; 1 || id > games.length) {
        return null;
    }

    id--;
    let gameData = games[id].board;
    let game = {
        board: new Minesweeper(gameData.size),
        elapsedTime: games[id].elapsedTime,
    };
    Object.assign(game.board, gameData);

    game.board.fields = gameData.fields.map((row) =>
        row.map((fieldData) => Object.assign(new Field(), fieldData))
    );

    return game;
}

/**
 * Creates a new game based on the URL search parameters.
 *
 * @returns {Object|null} The new game object or null if parameters are incorrect.
 */
export function newGame() {
    const size = searchParams.get("size");

    const isCorrectQuery =
        size &amp;&amp;
        !isNaN(size) &amp;&amp;
        size >= MIN_SIZE &amp;&amp;
        size &lt;= MAX_SIZE &amp;&amp;
        searchParams.get("difficulty");

    const result =
        {
            1: Difficulty.EASY,
            2: Difficulty.MEDIUM,
            3: Difficulty.HARD,
        }[searchParams.get("difficulty")] ?? null;

    if (!(isCorrectQuery &amp;&amp; result)) {
        return null;
    }

    return { board: new Minesweeper(searchParams.get("size"), result) };
}

/**
 * Deletes a specific saved game from localStorage.
 *
 * @param {number} id - The ID of the save to be deleted.
 */
export function deleteSave(id) {
    let games = parseGames();
    games.splice(id, 1);

    if (games.length === 0) {
        deleteSaves();
    } else {
        refreshCachedGames(games);
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BoardView.html">BoardView</a></li><li><a href="module-CurrentDate.html">CurrentDate</a></li><li><a href="module-Field.html">Field</a></li><li><a href="module-Minesweeper.html">Minesweeper</a></li><li><a href="module-Popup.html">Popup</a></li><li><a href="module-SaveGame.html">SaveGame</a></li><li><a href="module-State.html">State</a></li><li><a href="module-Stopwatch.html">Stopwatch</a></li></ul><h3>Classes</h3><ul><li><a href="module-BoardView.html">BoardView</a></li><li><a href="module-Field.html">Field</a></li><li><a href="module-Minesweeper.html">Minesweeper</a></li><li><a href="module-Stopwatch.html">Stopwatch</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Nov 13 2024 23:17:21 GMT+0100 (közép-európai téli idő)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
